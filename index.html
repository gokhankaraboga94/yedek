<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Türkiye'nin Enleri | Resimli Harita PRO</title>
    <style>
        :root { --male: #0084ff; --female: #ff007b; --dark: #1a1a1a; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: #f0f2f5; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        header { background: var(--dark); color: white; padding: 15px; text-align: center; z-index: 100; }
        
        /* MOBİL GEÇİŞ BUTONLARI (Her zaman görünür) */
        .tab-controls { display: flex; background: white; border-bottom: 2px solid #ddd; }
        .tab-btn { flex: 1; padding: 15px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; opacity: 0.6; }
        .tab-btn.active-male { background: var(--male); color: white; opacity: 1; }
        .tab-btn.active-female { background: var(--female); color: white; opacity: 1; }

        .container { display: flex; flex: 1; overflow: hidden; position: relative; }
        .pane { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        .pane-male { background: #e3f2fd; border-right: 2px solid #ccc; }
        .pane-female { background: #fff0f6; }
        
        .pane h2 { margin-bottom: 10px; font-size: 1.2rem; }

        /* HARİTA */
        .map-box { width: 100%; max-width: 600px; }
        svg { width: 100%; height: auto; border-radius: 8px; background: rgba(255,255,255,0.5); }
        .city-path { fill: #fff; stroke: #999; stroke-width: 0.5; cursor: pointer; }
        .city-label { font-size: 10px; font-weight: bold; pointer-events: none; fill: #333; }

        /* MODALS */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:1000; padding:15px; }
        .modal-content { background:white; padding:25px; border-radius:15px; width:100%; max-width:400px; }
        input, select { width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:8px; }
        .btn-submit { background: #28a745; color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; }

        @media (max-width: 768px) {
            .pane { display: none; }
            .pane.mobile-active { display: flex; width: 100%; }
        }
    </style>
</head>
<body>

<header>
    <h1>TÜRKİYE'NİN ENLERİ</h1>
    <button onclick="document.getElementById('uploadModal').style.display='flex'" style="margin-top:10px; padding:8px 20px; border-radius:20px; border:none; background:#ff9800; color:white; font-weight:bold; cursor:pointer;">Yarışmacı Ol</button>
</header>

<div class="tab-controls">
    <button class="tab-btn active-male" id="btnM" onclick="switchTab('male')">ERKEKLER</button>
    <button class="tab-btn" id="btnF" onclick="switchTab('female')">KADINLAR</button>
</div>

<div class="container">
    <div class="pane pane-male mobile-active" id="paneMale">
        <h2>ERKEKLER HARİTASI</h2>
        <div class="map-box" id="svgMale"></div>
    </div>
    <div class="pane pane-female" id="paneFemale">
        <h2>KADINLAR HARİTASI</h2>
        <div class="map-box" id="svgFemale"></div>
    </div>
</div>

<div id="uploadModal" class="modal">
    <div class="modal-content">
        <h3>Yeni Aday Ekle</h3>
        <select id="upGender">
            <option value="male">Erkek</option>
            <option value="female">Kadın</option>
        </select>
        <input type="number" id="upCity" placeholder="Şehir Plaka (1-81)">
        <input type="text" id="upName" placeholder="İsminiz">
        <input type="file" id="upFile" accept="image/*">
        <button class="btn-submit" onclick="submitAday()">Hemen Yayına Al</button>
        <button onclick="this.parentElement.parentElement.style.display='none'" style="width:100%; background:none; border:none; margin-top:10px; cursor:pointer; color:#666;">Kapat</button>
    </div>
</div>

<div id="voteModal" class="modal">
    <div class="modal-content">
        <h3 id="vTitle">Şehir Adayları</h3>
        <div id="candidateList" style="margin-top:15px; max-height:300px; overflow-y:auto;"></div>
        <button onclick="this.parentElement.parentElement.style.display='none'" style="width:100%; padding:10px; margin-top:10px;">Kapat</button>
    </div>
</div>

<script>
    let adaylar = JSON.parse(localStorage.getItem('aday_verileri')) || [];

    function switchTab(g) {
        document.getElementById('paneMale').classList.toggle('mobile-active', g === 'male');
        document.getElementById('paneFemale').classList.toggle('mobile-active', g === 'female');
        document.getElementById('btnM').classList.toggle('active-male', g === 'male');
        document.getElementById('btnF').classList.toggle('active-female', g === 'female');
    }

    function renderMaps() {
        const draw = (id, gender) => {
            let defs = "<defs>";
            let content = "";
            for (let i = 1; i <= 81; i++) {
                const leader = adaylar.filter(a => a.city == i && a.gender == gender).sort((a,b)=>b.votes-a.votes)[0];
                let fill = "#ffffff";
                if(leader) {
                    defs += `<pattern id="p-${gender}-${i}" width="1" height="1" patternUnits="objectBoundingBox">
                                <image href="${leader.img}" width="80" height="50" preserveAspectRatio="xMidYMid slice"/>
                             </pattern>`;
                    fill = `url(#p-${gender}-${i})`;
                }
                const x = ((i-1)%9)*65; const y = Math.floor((i-1)/9)*45;
                content += `<rect x="${x}" y="${y}" width="60" height="40" class="city-path" style="fill:${fill}" onclick="openCity(${i},'${gender}')"/>
                            <text x="${x+5}" y="${y+15}" class="city-label">${i}</text>`;
            }
            document.getElementById(id).innerHTML = `<svg viewBox="0 0 580 420">${defs}</defs>${content}</svg>`;
        };
        draw('svgMale', 'male');
        draw('svgFemale', 'female');
    }

    function submitAday() {
        const gender = document.getElementById('upGender').value;
        const city = document.getElementById('upCity').value;
        const name = document.getElementById('upName').value;
        const file = document.getElementById('upFile').files[0];

        if(!city || !name || !file) { alert("Lütfen tüm alanları doldur ve fotoğraf seç!"); return; }

        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function() {
            adaylar.push({ id: Date.now(), gender, city, name, img: reader.result, votes: 0 });
            localStorage.setItem('aday_verileri', JSON.stringify(adaylar));
            alert("Başarıyla eklendi!");
            document.getElementById('uploadModal').style.display = 'none';
            renderMaps();
        };
        reader.onerror = () => alert("Dosya okunurken hata oluştu!");
    }

    function openCity(cityId, gender) {
        const filtered = adaylar.filter(a => a.city == cityId && a.gender == gender).sort((a,b)=>b.votes-a.votes);
        document.getElementById('vTitle').innerText = cityId + ". Şehir Adayları";
        const list = document.getElementById('candidateList');
        list.innerHTML = filtered.length ? filtered.map(a => `
            <div style="display:flex; align-items:center; margin-bottom:10px; background:#f9f9f9; padding:10px; border-radius:8px;">
                <img src="${a.img}" style="width:50px; height:50px; border-radius:50%; object-fit:cover; margin-right:10px;">
                <div style="flex:1"><b>${a.name}</b><br><small>${a.votes} Oy</small></div>
                <button onclick="vote(${a.id})" style="background:orange; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">Oy Ver</button>
            </div>
        `).join('') : "Henüz aday yok.";
        document.getElementById('voteModal').style.display = 'flex';
    }

    function vote(id) {
        const idx = adaylar.findIndex(a => a.id === id);
        adaylar[idx].votes++;
        localStorage.setItem('aday_verileri', JSON.stringify(adaylar));
        renderMaps();
        document.getElementById('voteModal').style.display = 'none';
    }

    window.onload = renderMaps;
</script>
</body>
</html>
